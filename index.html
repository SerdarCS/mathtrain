<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Algebra Sprint — Minimal (LaTeX)</title>
  <script>
  // Helper removed: use normal strings with double backslashes for LaTeX
    // Queue elements for typesetting until MathJax is ready
    window.__mjxQueue = [];
    window.__mjxReady = false;
    window.MathJax = {
      tex: {
        inlineMath: [["\\(","\\)"],["$","$"]],
        displayMath: [["\\[","\\]"],["$$","$$"]],
        processEscapes: true
      },
      svg: { fontCache: 'global' },
      startup: {
        typeset: true,
        ready: () => {
          MathJax.startup.defaultReady();
          window.__mjxReady = true;
          if (window.__mjxQueue && window.__mjxQueue.length){
            const els = Array.from(new Set(window.__mjxQueue));
            try{ if (MathJax.typesetClear){ MathJax.typesetClear(els); } }catch(_){ }
            MathJax.typesetPromise(els).catch(()=>{});
            window.__mjxQueue.length = 0;
          }
        }
      }
    };
  </script>
  <!-- Use the full TeX bundle so macros like \dfrac render correctly -->
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg-full.js"></script>
  <style>
    :root{
      /* Only 4 colors to tweak */
      --bg:#0f1222;        /* app background */
      --card:#171a2e;      /* surfaces */
      --ink:#e9ecff;       /* text */
      --accent:#c9d5f0;    
      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg:#f6f8fd;
        --card:#ffffff;
        --ink:#111827;
        --accent:#c9d5f0;
        --shadow:0 10px 24px rgba(16,24,40,.12);
      }
    }
    *{box-sizing:border-box}
    body{ margin:0; background:var(--bg); color:var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial}
    html.modal-open{ height:100%; overflow:hidden; overscroll-behavior:none }
    body.modal-open{ height:100%; overflow:hidden; overscroll-behavior:none; position:fixed; top:0; left:0; right:0; bottom:0; width:100% }
    header{ display:flex; align-items:center; justify-content:space-between;
      padding:16px clamp(16px, 3vw, 28px); position:sticky; top:0; z-index:10; background:transparent }
    /* Fixed top blur that does not move with scroll; sits behind header */
    .viewport-blur{ position:fixed; inset:0 auto auto 0; width:100%; height:72px; pointer-events:none; z-index:5;
      -webkit-backdrop-filter:saturate(140%) blur(8px); backdrop-filter:saturate(140%) blur(8px);
      -webkit-mask-image:linear-gradient(to bottom, rgba(0,0,0,1), rgba(0,0,0,0));
      mask-image:linear-gradient(to bottom, rgba(0,0,0,1), rgba(0,0,0,0)); }
    .brand{display:flex; gap:12px; align-items:center}
    .brand .logo{ width:36px; height:36px; border-radius:10px;
      background: radial-gradient(120% 120% at 10% 0%, var(--accent), transparent 60%), var(--card);
      box-shadow:var(--shadow);
    }
    .brand h1{font-size:18px; margin:0; letter-spacing:.3px}
    .controls{display:flex; gap:10px; align-items:center}
    button{ appearance:none; border:none; border-radius:12px; padding:12px 16px;
      background:var(--accent); color:#071018; font-weight:700; cursor:pointer; box-shadow:var(--shadow); }
    button.secondary{ background:var(--card); color:var(--ink); font-weight:600; box-shadow: inset 0 0 0 1px rgba(255,255,255,.08) }
    main{ max-width:960px; margin:0 auto; padding:24px clamp(16px, 3vw, 28px); }
    .cards{ display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:14px; }
    .card{ background:var(--card); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow), inset 0 0 0 1px rgba(255,255,255,.08); }
    .pill{ font-size:12px; padding:0; color:var(--ink); opacity:.75; font-weight:700; background:transparent; border-radius:0; box-shadow:none }
    .skill-title{font-weight:800; margin:6px 0 8px 0}
    .skill-desc{font-size:13px; color:var(--ink); opacity:.8; min-height:34px}
    .progress{ height:10px; border-radius:999px; background:var(--card); overflow:hidden; margin-top:10px; box-shadow: inset 0 0 0 1px rgba(255,255,255,.08) }
    .bar{ height:100%; width:0%; background:linear-gradient(90deg, var(--accent), var(--accent)); transition:width .35s ease }
    /* Full-screen session that behaves like its own page */
    .session{ position:fixed; inset:0; display:none; background:var(--bg); z-index:9999; width:100%; max-width:100vw; height:100vh; padding:0; overflow-y:auto; overscroll-behavior:contain; flex-direction:column }
    @supports (height: 100dvh){ .session{ height:100dvh } }
    .session.open{ display:flex }
    .problem-card{ position:relative; background:var(--bg); border-radius:0; padding:clamp(12px,3.5vw,22px); border:none; box-shadow:none; width:100%; max-width:100vw; min-height:100%; display:flex; flex-direction:column; flex:1 }
    .problem-card > .row:first-child{ margin-bottom:10px }
    .prompt{font-size:clamp(17px,4.2vw,20px); font-weight:800; margin:6px 0 10px 0; line-height:1.3}
    .subtle{ color:var(--ink); opacity:.75; font-size:clamp(12px,3.4vw,13px); margin-bottom:8px }
    .mcq{ display:grid; gap:12px; margin-top:10px; margin-bottom:12px; grid-template-columns:1fr }
    .mcq button{text-align:left; background:var(--card); padding:12px 14px; min-height:46px; font-size:clamp(15px,4.0vw,17px); touch-action:manipulation; box-shadow: inset 0 0 0 1px rgba(255,255,255,.08); color:var(--ink); white-space:normal }
    /* Ensure MathJax display math lays out matrices over multiple lines inside buttons */
    .mcq button mjx-container{ display:block !important; overflow:visible }
    .mcq button mjx-container[display="true"]{ margin: 4px 0; text-align:left !important }
    /* Left-align display math in prompts and within the session card */
    .problem-card mjx-container[display="true"]{ text-align:left !important; margin-left:0 !important }
    /* Session buttons */
    .problem-card .row button.secondary{ background:var(--card); color:var(--ink); box-shadow: inset 0 0 0 1px rgba(255,255,255,.08) }
    .problem-card .row button.secondary:hover,
    .problem-card .row button.secondary:focus-visible,
    .mcq button:hover,
    .mcq button:focus-visible{ box-shadow: inset 0 0 0 2px var(--ink); outline:none }
    .problem-card .row button.secondary:active,
    .mcq button:active{ transform: translateY(0.5px) }
    /* Stronger visible outlines in light mode to match dark mode contrast */
    @media (prefers-color-scheme: light){
      .mcq button,
      .problem-card .row button.secondary,
      .feedback,
      .card,
      .progress{
        box-shadow: inset 0 0 0 1px rgba(16,24,40,.12);
      }
      .pill{ box-shadow: none !important; background: transparent !important; }
    }
    .answer-row{ display:none }
    input[type="text"]{ flex:1; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
      background:transparent; color:var(--ink); font-size:16px; outline:none }
    .feedback{ margin:0 0 8px 0; padding:0; background:transparent; display:block; font-weight:700; box-shadow:none }
    .hint{ font-size:14px; color:var(--ink); opacity:.75; margin-top:8px; display:none }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px }
    .spacer{ height:20px }
    .problem-card{ padding-bottom:calc(env(safe-area-inset-bottom) + 24px) }
    body.modal-open header{ display:none }
    /* Sticky top bar so Home is always reachable */
    /* Session header row should behave like normal content (no sticky bar) */
    .topbar{ position:static; padding-top:0; padding-bottom:6px; box-shadow:none; background:transparent }
    .topbar::before{ display:none }
    /* Prevent any horizontal scrolling in page and session */
    html, body{ overflow-x:hidden }
    .session{ overflow-x:hidden }
    .problem-card{ overflow-x:hidden }
    .topbar .pill{ font-size:11px; padding:0 }
    #homeBtn{ margin-left:auto; padding:6px 10px; font-size:12px; border-radius:10px }
    /* Feedback modal */
    .feedback-modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.45); z-index:10000 }
    .feedback-modal.open{ display:flex }
    .feedback-card{ background:var(--card); color:var(--ink); width:min(560px,92vw); border-radius:12px; padding:16px; box-shadow: var(--shadow), inset 0 0 0 1px rgba(255,255,255,.08) }
    .feedback-card .actions{ margin-top:12px; display:flex; justify-content:flex-end; gap:10px }
    @media (max-width:640px){
      .controls{ display:none }
      .mcq button, .row button{ width:100% }
      .row{ gap:8px }
    }
    .footer{ margin-top:26px; font-size:13px; color:var(--ink); opacity:.65; text-align:center }
    @media (max-width:560px){ .cards{ grid-template-columns: 1fr } }
  </style>
</head>
<body>
  <div class="viewport-blur" aria-hidden="true"></div>
  <header>
    <div class="brand" role="banner" aria-label="Algebra Sprint">
      <div class="logo" aria-hidden="true"></div>
      <h1 style="position:relative; z-index:11">Algebra Sprint</h1>
    </div>
    
  </header>

  <main>
    <section class="cards" id="skills">
      <div class="card">
        <div class="pill">Skill</div>
        <div class="skill-title">Arithmetic & Simplify</div>
        <div class="skill-desc">Fractions, exponents, order–of–operations.</div>
        <button data-skill="arithmetic">Practice</button>
      </div>

      <div class="card">
        <div class="pill">Skill</div>
        <div class="skill-title">Linear & Quadratic</div>
        <div class="skill-desc">Solve \(ax+b=c\), expand, factor nice quadratics.</div>
        <button data-skill="algebra">Practice</button>
      </div>

      <div class="card">
        <div class="pill">Skill</div>
        <div class="skill-title">Calculus Intuition</div>
        <div class="skill-desc">Derivatives, limits, and basic integrals.</div>
        <button data-skill="calculus">Practice</button>
      </div>

      <div class="card">
        <div class="pill">Skill</div>
        <div class="skill-title">Probability Basics</div>
        <div class="skill-desc">Coins, dice, combinations, and simple EV.</div>
        <button data-skill="probability">Practice</button>
      </div>

      <div class="card">
        <div class="pill">Skill</div>
        <div class="skill-title">Linear Algebra</div>
        <div class="skill-desc">2×2 matrix ops, small vectors, 2×2 det.</div>
        <button data-skill="linalg">Practice</button>
      </div>

      <div class="card">
        <div class="pill">Mode</div>
        <div class="skill-title">Mixed Session</div>
        <div class="skill-desc">A short set across all skills. 10 questions, instant feedback.</div>
        <button data-skill="mixed">Start 10‑Q Sprint</button>
      </div>
    </section>

    <section class="session" id="session" aria-live="polite">
      <div class="problem-card" id="problemCard">
        <div class="row topbar">
          <div class="pill" id="skillTag">Skill</div>
          <div class="pill" id="progressTag">0 / 10</div>
          <button class="secondary" id="homeBtn" style="margin-left:auto">Home</button>
        </div>
        <p class="prompt" id="prompt">Prompt goes here</p>
        <p class="subtle" id="instruction">Choose the correct answer.</p>

        <div id="inputArea" class="answer-row">
          <input type="text" id="answerInput" inputmode="decimal" aria-label="Your answer" placeholder="Type answer…" />
          <button id="checkBtn">Check</button>
        </div>

        <div id="mcqArea" class="mcq" role="group" aria-label="Choices" style="display:none"></div>

        <div class="row">
          <button class="secondary" id="hintBtn">Hint</button>
          <button class="secondary" id="skipBtn" title="Skip">Skip</button>
        </div>

        
        <div class="hint" id="hint"></div>

        <div class="spacer"></div>
        <div class="progress"><div class="bar" id="sessionBar"></div></div>
      </div>
      <div id="feedbackModal" class="feedback-modal" role="dialog" aria-modal="true" aria-live="polite">
        <div class="feedback-card">
          <div class="feedback" id="feedback"></div>
          <div class="actions">
            <button class="secondary" id="closeFeedbackBtn">Close</button>
            <button id="nextFeedbackBtn">Next</button>
          </div>
        </div>
      </div>
      
    </section>
  </main>

  <script src="math.js"></script>
  <script src="app.js"></script>
</body>
</html>
